import{L as N,P as o,O as a,V as d,S as n,R as e,a1 as k,X as y,Z as S,a2 as b,C as A,$ as w,F as g,a0 as f,ai as F,a7 as L,d as x,k as T,o as R,N as C,W as h}from"./framework.B2q356Un.js";const D={name:"AchievementViewer",props:{appid:{type:String,required:!0}},data(){return{achievements:null,loading:!1,error:null,showAchievedLeftFade:!1,showAchievedRightFade:!1,showNotAchievedLeftFade:!1,showNotAchievedRightFade:!1,selectedAchievement:null,activeTab:"achieved"}},computed:{achievedAchievements(){return this.achievements?this.achievements.details.filter(r=>r.achieved):[]},notAchievedAchievements(){return this.achievements?this.achievements.details.filter(r=>!r.achieved):[]},indicatorStyle(){return{left:this.activeTab==="achieved"?"0%":"50%",width:"50%"}}},watch:{appid:{immediate:!0,handler(r){r&&this.fetchAchievements(r)}}},mounted(){this.$nextTick(()=>{this.updateFades("achieved"),this.updateFades("notAchieved")})},updated(){this.$nextTick(()=>{this.updateFades("achieved"),this.updateFades("notAchieved")})},methods:{async fetchAchievements(r){this.loading=!0,this.error=null,this.achievements=null;try{const l=`https://api.yunlinsan.ren/api/achievements?appid=${r}`,m=await(await fetch(l)).json();if(!m.playerstats||m.playerstats.success===!1)throw new Error("无法获取玩家成就数据");const s=`https://api.yunlinsan.ren/api/schema?appid=${r}`,i=await(await fetch(s)).json();if(!i.game||!i.game.availableGameStats||!i.game.availableGameStats.achievements)throw new Error("无法获取成就描述信息");const u={};for(const c of i.game.availableGameStats.achievements)u[c.name]=c;const t=m.playerstats.achievements.map(c=>{const p=u[c.apiname]||{};return{apiname:c.apiname,achieved:c.achieved,unlocktime:c.unlocktime,...p}});this.achievements={gameName:m.playerstats.gameName,details:t},this.$nextTick(()=>{this.updateFades("achieved"),this.updateFades("notAchieved")})}catch(l){this.error=l.message}finally{this.loading=!1}},onScroll(r){this.updateFades(r)},updateFades(r){if(r==="achieved"){const l=this.$refs.achievedRow;if(!l)return;this.showAchievedLeftFade=l.scrollLeft>10,this.showAchievedRightFade=l.scrollWidth-l.clientWidth-l.scrollLeft>10}else if(r==="notAchieved"){const l=this.$refs.notAchievedRow;if(!l)return;this.showNotAchievedLeftFade=l.scrollLeft>10,this.showNotAchievedRightFade=l.scrollWidth-l.clientWidth-l.scrollLeft>10}},showDetail(r){this.selectedAchievement=r},formatDate(r){return r?new Date(r*1e3).toLocaleString():"未知时间"}}},$={class:"achievement-panel"},M={key:0,class:"loading"},q={key:1,class:"error"},G={key:2,class:"achievement-list"},V={class:"md-tabs"},W=["onClick"],j=["src","alt"],B={class:"achievement-info"},H={key:0,class:"fade-gradient left"},E={key:1,class:"fade-gradient right"},P=["onClick"],z=["src","alt"],U={class:"achievement-info"},I={key:0,class:"fade-gradient left"},O={key:1,class:"fade-gradient right"},X={class:"detail-content"},Z={class:"detail-header"},J=["src"],K={class:"detail-body"},Q={class:"description"},Y={key:0,class:"unlock-time"},ee={key:1,class:"unlock-time"};function te(r,l,_,m,s,v){return a(),o("div",$,[s.loading?(a(),o("div",M,"加载中...")):d("v-if",!0),s.error?(a(),o("div",q,n(s.error),1)):d("v-if",!0),s.achievements?(a(),o("div",G,[d(" Material Design Tabs "),e("div",V,[e("button",{class:y(["md-tab",{active:s.activeTab==="achieved"}]),onClick:l[0]||(l[0]=i=>s.activeTab="achieved")},"已达成",2),e("button",{class:y(["md-tab",{active:s.activeTab==="notAchieved"}]),onClick:l[1]||(l[1]=i=>s.activeTab="notAchieved")},"未达成",2),e("div",{class:"md-tab-indicator",style:S(v.indicatorStyle)},null,4)]),d(" Tab content "),k(e("div",null,[l[6]||(l[6]=e("div",{class:"section-label"},"已达成成就",-1)),e("div",{class:"achievement-row achieved-row",ref:"achievedRow",onScroll:l[2]||(l[2]=i=>v.onScroll("achieved"))},[A(F,{name:"fade",tag:"div",class:"achievement-row-inner"},{default:w(()=>[(a(!0),o(g,null,f(v.achievedAchievements,i=>(a(),o("div",{key:i.apiname,class:"achievement-card achieved",onClick:u=>v.showDetail(i)},[e("img",{src:i.icon,alt:i.displayName||i.apiname,class:"achievement-icon"},null,8,j),e("div",B,[e("h3",null,n(i.displayName||i.apiname),1),e("p",null,n(i.description||""),1)])],8,W))),128))]),_:1}),s.showAchievedLeftFade?(a(),o("div",H)):d("v-if",!0),s.showAchievedRightFade?(a(),o("div",E)):d("v-if",!0)],544)],512),[[b,s.activeTab==="achieved"]]),k(e("div",null,[l[7]||(l[7]=e("div",{class:"section-label"},"未达成成就",-1)),e("div",{class:"achievement-row not-achieved-row",ref:"notAchievedRow",onScroll:l[3]||(l[3]=i=>v.onScroll("notAchieved"))},[A(F,{name:"fade",tag:"div",class:"achievement-row-inner"},{default:w(()=>[(a(!0),o(g,null,f(v.notAchievedAchievements,i=>(a(),o("div",{key:i.apiname,class:"achievement-card not-achieved",onClick:u=>v.showDetail(i)},[e("img",{src:i.icongray,alt:i.displayName||i.apiname,class:"achievement-icon"},null,8,z),e("div",U,[e("h3",null,n(i.displayName||i.apiname),1),e("p",null,n(i.description||""),1)])],8,P))),128))]),_:1}),s.showNotAchievedLeftFade?(a(),o("div",I)):d("v-if",!0),s.showNotAchievedRightFade?(a(),o("div",O)):d("v-if",!0)],544)],512),[[b,s.activeTab==="notAchieved"]])])):d("v-if",!0),d(" 成就详情弹窗 "),s.selectedAchievement?(a(),o("div",{key:3,class:"achievement-detail-modal",onClick:l[5]||(l[5]=L(i=>s.selectedAchievement=null,["self"]))},[e("div",X,[e("div",Z,[e("img",{src:s.selectedAchievement.achieved?s.selectedAchievement.icon:s.selectedAchievement.icongray,class:"detail-icon"},null,8,J),e("h2",null,n(s.selectedAchievement.displayName||s.selectedAchievement.apiname),1),e("div",{class:y(["achievement-status",{achieved:s.selectedAchievement.achieved}])},n(s.selectedAchievement.achieved?"已解锁":"未解锁"),3)]),e("div",K,[e("p",Q,n(s.selectedAchievement.description||"暂无描述"),1),s.selectedAchievement.achieved?(a(),o("div",Y," 解锁时间: "+n(v.formatDate(s.selectedAchievement.unlocktime)),1)):(a(),o("div",ee," 尚未解锁 "))]),e("button",{class:"close-button",onClick:l[4]||(l[4]=i=>s.selectedAchievement=null)},"关闭")])])):d("v-if",!0)])}const se=N(D,[["render",te],["__scopeId","data-v-b12c899d"]]),le={key:0,class:"game-detail"},ie={key:0,class:"hero-banner"},ne=["href"],ae=["src"],oe={class:"title-row"},re={class:"title-center"},ce=["src","alt"],de={class:"game-title"},ue=["innerHTML"],ve={class:"achievement-bar"},he=["href"],me=["src","alt"],pe=["href"],ge=["href"],fe=["checked"],_e=["checked"],ye=["href"],ke={style:{margin:"16px 0",background:"#f8f9fa",padding:"12px","border-radius":"8px"}},be=["innerHTML"],Ae={key:1},we={key:2},Fe={key:3},Te={key:4},Ne={__name:"GameDetail",props:{src:{type:String,required:!0}},setup(r){const l={strategy:"攻略",patch:"补丁",fandom:"Fandom",pcgamingwiki:"PCGamingWiki"};function _(u){return l[u]||u}const m=r,s=x(null),v=T(()=>{if(!s.value)return 0;const u=Number(s.value.achievement_progress)||0,t=Number(s.value.achievement_total)||0;return t?Math.floor(u/t*100):0}),i=T(()=>{if(!s.value||!s.value.steam)return null;const u=s.value.steam.match(/\/app\/(\d+)/);return u?u[1]:null});return R(async()=>{const t=await(await fetch(m.src)).json();s.value={name:t.name||"未知游戏",hero:t.hero||"",logo:t.logo,alias:t.alias,types:Array.isArray(t.types)?t.types.join(", "):t.types,status:t.status,rating:t.rating,achievement_progress:t.achievement_progress,achievement_total:t.achievement_total,price:t.price,channel:t.channel,platform:t.platform,cover:t.cover,steamdb:t.steamdb,steam:t.steam,played_hours:t.played_hours,progress:{achievement:!!t.progress_achievement,collection:!!t.progress_collection},guides:t.guides||[],tips:t.tips||"",brief:t.brief||"",highlights:t.highlights||[""],cons:t.cons||[""],note:t.note||""}}),(u,t)=>s.value?(a(),o("div",le,[s.value.hero?(a(),o("div",ie,[e("a",{href:s.value.hero,target:"_blank"},[e("img",{src:s.value.hero,class:"hero-image",alt:"banner"},null,8,ae)],8,ne)])):d("v-if",!0),e("div",oe,[e("div",re,[s.value.logo?(a(),o("img",{key:0,src:s.value.logo,alt:`${s.value.name} Logo`,class:"game-logo"},null,8,ce)):d("v-if",!0),e("h1",de,n(s.value.name),1)])]),e("ul",null,[e("li",null,[t[0]||(t[0]=e("strong",null,"游戏别名：",-1)),h(n(s.value.alias),1)]),e("li",null,[t[1]||(t[1]=e("strong",null,"游戏类型：",-1)),h(n(s.value.types),1)]),e("li",null,[t[2]||(t[2]=e("strong",null,"游玩状态：",-1)),h(n(s.value.status),1)]),e("li",null,[t[3]||(t[3]=e("strong",null,"我的评级：",-1)),e("span",{innerHTML:s.value.rating},null,8,ue)]),e("li",null,[t[4]||(t[4]=e("strong",null,"成就进度：",-1)),h(n(s.value.achievement_progress)+"/"+n(s.value.achievement_total),1)]),i.value?(a(),C(se,{key:0,appid:i.value},null,8,["appid"])):d("v-if",!0),e("li",null,[t[5]||(t[5]=e("strong",null,"成就达成：",-1)),h(n(v.value)+"% ",1),e("div",ve,[e("div",{class:"achievement-bar-fill",style:S({width:v.value+"%"})},null,4)])]),e("li",null,[t[6]||(t[6]=e("strong",null,"购入价格：",-1)),h(n(s.value.price),1)]),e("li",null,[t[7]||(t[7]=e("strong",null,"购入渠道：",-1)),h(n(s.value.channel),1)]),e("li",null,[t[8]||(t[8]=e("strong",null,"游戏平台：",-1)),h(n(s.value.platform),1)]),e("li",null,[t[9]||(t[9]=e("strong",null,"封面：",-1)),e("a",{href:s.value.cover,target:"_blank"},[e("img",{src:s.value.cover,alt:`${s.value.name} Cover`,style:{"max-width":"320px","vertical-align":"middle"}},null,8,me)],8,he)]),e("li",null,[t[10]||(t[10]=e("strong",null,"SteamDB链接：",-1)),e("a",{href:s.value.steamdb,target:"_blank"},n(s.value.steamdb),9,pe)]),e("li",null,[t[11]||(t[11]=e("strong",null,"Steam链接：",-1)),e("a",{href:s.value.steam,target:"_blank"},n(s.value.steam),9,ge)]),e("li",null,[t[12]||(t[12]=e("strong",null,"总成就数：",-1)),h(n(s.value.achievement_total),1)]),e("li",null,[t[13]||(t[13]=e("strong",null,"已刷时长：",-1)),h(n(s.value.played_hours),1)])]),e("details",null,[t[16]||(t[16]=e("summary",null,[e("strong",null,"游玩中进度记录")],-1)),e("ul",null,[e("li",null,[e("label",null,[e("input",{type:"checkbox",disabled:"",checked:s.value.progress.achievement},null,8,fe),t[14]||(t[14]=h(" 成就"))])]),e("li",null,[e("label",null,[e("input",{type:"checkbox",disabled:"",checked:s.value.progress.collection},null,8,_e),t[15]||(t[15]=h(" 收集"))])])])]),e("details",null,[t[17]||(t[17]=e("summary",null,[e("strong",null,"攻略&补丁")],-1)),e("ul",null,[(a(!0),o(g,null,f(s.value.guides,c=>(a(),o("li",{key:c.type},[e("strong",null,n(_(c.type))+"：",1),e("a",{href:c.url,target:"_blank"},n(c.title),9,ye)]))),128))])]),e("aside",ke,[t[18]||(t[18]=e("strong",null,"💡 Tips：",-1)),e("div",{innerHTML:s.value.tips},null,8,be)]),t[19]||(t[19]=e("h2",null,"简评",-1)),s.value.brief?(a(),o("blockquote",Ae,n(s.value.brief),1)):(a(),o("blockquote",we,"（暂无简评）")),t[20]||(t[20]=e("h2",null,"亮点",-1)),e("ul",null,[(a(!0),o(g,null,f(s.value.highlights,(c,p)=>(a(),o("li",{key:p},n(c||"（暂无）"),1))),128))]),t[21]||(t[21]=e("h2",null,"缺点",-1)),e("ul",null,[(a(!0),o(g,null,f(s.value.cons,(c,p)=>(a(),o("li",{key:p},n(c||"（暂无）"),1))),128))]),t[22]||(t[22]=e("h3",null,"备注",-1)),s.value.note?(a(),o("blockquote",Fe,n(s.value.note),1)):(a(),o("blockquote",Te,"（暂无备注）"))])):d("v-if",!0)}},Le=N(Ne,[["__scopeId","data-v-4da6813c"]]);export{Le as _};
