import{_ as Z}from"./ValaxyMain.vue_vue_type_style_index_0_lang.1SnU40XN.js";import{L as tt,d as w,o as et,G as at,w as Y,P as y,O as f,R as m,V as A,S as z,a7 as nt,F as ot,a0 as st,N as rt,$ as o,u as it,Q as s,C as lt,E as ct}from"./framework.B2q356Un.js";import{e as ut,a as mt,u as ft}from"./chunks/vue-router.boI-fn6D.js";import"./app.DFlwCGXp.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.CMLyGrTw.js";import"./chunks/@vueuse/motion.khu2_hxe.js";import"./chunks/pinia.BgzrQb4O.js";import"./chunks/nprogress.Cino7761.js";import"./YunComment.vue_vue_type_style_index_0_lang.B9MzHDIb.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CnFc9STA.js";import"./post.CHIv70zM.js";const dt={class:"tag-cloud-container"},vt={key:0,class:"loading"},ht={key:1,class:"error"},gt={class:"tag-detail-inner"},pt={class:"tag-detail-title"},_t={class:"tag-detail-list"},wt=["href"],yt="/games/summary/TagSummary.json",$t={__name:"TagCloud",setup(x,{expose:$}){const d=w(null),b=w(!0),v=w(""),l=w([]),h=w([]),a=w(null);function n(t){return t<.2?"#bbb":t<.4?"#8ecae6":t<.6?"#219ebc":t<.8?"#4361ee":"#7209b7"}const k={minFontSize:16,maxFontSize:48,speed:.002};async function B(){b.value=!0,v.value="";try{const t=await fetch(yt);if(!t.ok)throw new Error("无法读取标签统计文件");const e=await t.json();l.value=e}catch(t){v.value="标签云加载失败: "+(t.message||t)}finally{b.value=!1}}let g=null,S=0;function p(){const t=d.value;if(!t)return;const e=t.getContext("2d"),r=t.width=t.offsetWidth,_=t.height=t.offsetHeight;if(e.clearRect(0,0,r,_),!l.value.length)return;const c=l.value.slice(0,40),i=Math.max(...c.map(u=>u.count)),L=Math.min(...c.map(u=>u.count));h.value=[];const R=Math.min(r,_)*.36,P=r/2,V=_/2;c.forEach((u,j)=>{const T=Math.acos(-1+(2*j+1)/c.length),D=Math.sqrt(c.length*Math.PI)*T+S;let C=R*Math.cos(D)*Math.sin(T),I=R*Math.sin(D)*Math.sin(T),N=R*Math.cos(T);const O=Math.sin(S),q=Math.cos(S),J=q*C+O*N,Q=-O*C+q*N;C=J,N=Q;const M=(u.count-L)/(i-L||1),U=k.minFontSize+M*(k.maxFontSize-k.minFontSize);e.font=`${M>.8?"bold ":""}${U}px Arial`,e.globalAlpha=.6+.4*M,e.fillStyle=n(M),e.textAlign="center",e.textBaseline="middle",M>.8?(e.shadowColor="#333",e.shadowBlur=12):e.shadowBlur=0;const X=`${u.tag} (${u.count})`;e.fillText(X,P+C,V+I);const W=e.measureText(X).width,K=U;h.value[j]={tag:u,x:P+C,y:V+I,w:W,h:K}})}function E(){S+=k.speed,p(),g=requestAnimationFrame(E)}function G(t){if(!h.value.length)return;const r=d.value.getBoundingClientRect(),_=t.clientX-r.left,F=t.clientY-r.top;for(let c=h.value.length-1;c>=0;c--){const i=h.value[c];if(_>=i.x-i.w/2&&_<=i.x+i.w/2&&F>=i.y-i.h/2&&F<=i.y+i.h/2){a.value=i.tag;return}}a.value=null}et(async()=>{await B(),p(),window.addEventListener("resize",p),g=requestAnimationFrame(E)}),at(()=>{window.removeEventListener("resize",p),g&&cancelAnimationFrame(g)}),Y(l,()=>{p()}),Y(a,()=>{p()});function H(){return a.value?typeof a.value=="object"&&a.value.games?a.value:l.value.find(t=>t.tag===(a.value.tag||a.value)):null}return $({getSelectedTagInfo:H}),(t,e)=>(f(),y("div",dt,[m("canvas",{ref_key:"canvasRef",ref:d,class:"tag-cloud-canvas",onClick:G},null,512),b.value?(f(),y("div",vt,"正在加载标签云...")):A("v-if",!0),v.value?(f(),y("div",ht,z(v.value),1)):A("v-if",!0),a.value?(f(),y("div",{key:2,class:"tag-detail",onClick:e[1]||(e[1]=nt(r=>a.value=null,["self"]))},[m("div",gt,[m("div",pt,[m("span",null,z(a.value.tag)+" ("+z(a.value.count)+")",1),m("button",{class:"close-btn",onClick:e[0]||(e[0]=r=>a.value=null)},"×")]),m("ul",_t,[(f(!0),y(ot,null,st(a.value.games,r=>(f(),y("li",{key:r.link},[m("a",{href:r.link,target:"_blank",rel:"noopener"},z(r.name),9,wt)]))),128))])])])):A("v-if",!0)]))}},bt=tt($t,[["__scopeId","data-v-b87207ef"]]),kt=ut("/games/tagcloud",async x=>JSON.parse('{"title":"游戏标签云","description":"","frontmatter":{"title":"游戏标签云"},"headers":[],"relativePath":"pages/games/tagcloud.md","lastUpdated":null}'),{lazy:(x,$)=>x.name===$.name}),Vt={__name:"tagcloud",setup(x,{expose:$}){var a;const{data:d}=kt(),b=ft(),v=mt(),l=Object.assign(v.meta.frontmatter||{},((a=d.value)==null?void 0:a.frontmatter)||{});return b.currentRoute.value.data=d.value,ct("valaxy:frontmatter",l),globalThis.$frontmatter=l,$({frontmatter:{title:"游戏标签云"}}),(n,k)=>{const B=bt,g=Z;return f(),rt(g,{frontmatter:it(l)},{"main-content-md":o(()=>[lt(B)]),"main-header":o(()=>[s(n.$slots,"main-header")]),"main-header-after":o(()=>[s(n.$slots,"main-header-after")]),"main-nav":o(()=>[s(n.$slots,"main-nav")]),"main-content-before":o(()=>[s(n.$slots,"main-content-before")]),"main-content":o(()=>[s(n.$slots,"main-content")]),"main-content-after":o(()=>[s(n.$slots,"main-content-after")]),"main-nav-before":o(()=>[s(n.$slots,"main-nav-before")]),"main-nav-after":o(()=>[s(n.$slots,"main-nav-after")]),comment:o(()=>[s(n.$slots,"comment")]),footer:o(()=>[s(n.$slots,"footer")]),aside:o(()=>[s(n.$slots,"aside")]),"aside-custom":o(()=>[s(n.$slots,"aside-custom")]),default:o(()=>[s(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{Vt as default,kt as usePageData};
